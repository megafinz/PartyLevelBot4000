<html>
    <head>
        <title>Party Level Bot 4000 (Receiver)</title>
        <style>
            .volume {
                width: 100%;
                background-color: grey;
            }

            .meter {
                width: 0%;
                height: 30px;
                background-color: #4CAF50;
                text-align: center; /* To center it horizontally (if you want) */
                line-height: 30px; /* To center it vertically */
                color: white;
            }
        </style>
    </head>

    <body>
        <h1>PARTY LEVEL BOT 4000</h1>

        <div class="volume">
            <div id="current-meter" class="meter">0%</div>
            <div id="max-meter" class="meter">0%</div>
        </div>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            var currentAmp = 0;
            var maxAmp = 0;
            var resetCurrentAmpTimeout;

            var socket = io();

            socket.on('amplitude out', function (amp) {
                setCurrentAmp(amp);
                clearTimeout(resetCurrentAmpTimeout);
                resetCurrentAmpTimeout = setTimeout(function() {
                    setCurrentAmp(0);
                }, 1000)
            });

            function setCurrentAmp(amp) {
                currentAmp = amp;
                setMeter("current-meter", Math.round(amp * 100));
                if (maxAmp < amp) {
                    setMaxAmp(amp);
                }
            }

            function setMaxAmp(amp) {
                maxAmp = amp;
                setMeter("max-meter", Math.round(maxAmp * 100));
            }

            function setMeter(id, value) {
                var elem = document.getElementById(id);
                elem.style.width = value + '%';
                elem.innerHTML = value * 1 + '%';
            }

            function refreshMaxAmp() {
                setMaxAmp(currentAmp);
            }

            setInterval(refreshMaxAmp, 3000);
        </script>
    </body>
</html>
